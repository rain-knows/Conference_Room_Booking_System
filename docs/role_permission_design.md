# 会议室预约管理系统角色权限设计文档

## 1. 用户角色与权限

系统采用基于字段映射的权限管理机制，通过用户角色和会议室类型的组合来控制访问权限。系统包含以下三种角色：

1.  **普通员工 (NORMAL_EMPLOYEE)**：系统的基本用户，可以查询和预约会议室，并管理自己的预约。
2.  **领导 (LEADER)**：拥有普通员工的所有权限，并且可以预约所有类型的会议室。
3.  **系统管理员 (SYSTEM_ADMIN)**：拥有最高权限，负责管理用户、会议室、系统配置和监控整个系统。

## 2. 权限模型设计

### 2.1 权限维度

系统采用三维权限模型：

1. **用户角色维度**: NORMAL_EMPLOYEE, LEADER, SYSTEM_ADMIN
2. **会议室类型维度**: BASIC, PREMIUM, VIP
3. **权限类型维度**: 查看(canView), 预订(canBook), 管理(canManage)

### 2.2 权限映射表

权限配置通过 `PermissionMapping` 表进行管理，包含以下字段：

- `userRole`: 用户角色
- `roomTypeCode`: 会议室类型代码
- `canBook`: 是否可以预订
- `canView`: 是否可以查看
- `canManage`: 是否可以管理
- `description`: 权限描述

### 2.3 默认权限配置

| 用户角色 | 基础会议室 | 高级会议室 | VIP会议室 |
|---------|-----------|-----------|-----------|
| SYSTEM_ADMIN | 完全管理 | 完全管理 | 完全管理 |
| LEADER | 可预订查看 | 可预订查看 | 可预订查看 |
| NORMAL_EMPLOYEE | 可预订查看 | 仅查看 | 无权限 |

## 3. 角色职责详细说明

### 3.1 普通员工 (NORMAL_EMPLOYEE)

**基本权限**:
- 查询会议室和其可用状态（仅限有权限的会议室类型）
- 创建和管理自己的会议预约
- 查看个人信息和修改密码

**会议室权限**:
- 基础会议室：可查看、可预订
- 高级会议室：仅可查看
- VIP会议室：无权限

**界面限制**:
- 会议室列表中只显示有权限查看的会议室
- 预订按钮根据权限动态启用/禁用
- 无法访问管理功能

### 3.2 领导 (LEADER)

**基本权限**:
- 拥有普通员工的所有权限
- 可以预约所有类型的会议室
- 查看会议室详细信息

**会议室权限**:
- 基础会议室：可查看、可预订
- 高级会议室：可查看、可预订
- VIP会议室：可查看、可预订

**界面限制**:
- 可以查看所有会议室
- 可以预订所有类型的会议室
- 无法访问管理功能

### 3.3 系统管理员 (SYSTEM_ADMIN)

**基本权限**:
- 拥有领导的所有权限
- 管理所有用户账户（创建、修改、删除、启用/禁用）
- 管理所有会议室和设备
- 管理系统中的所有预约
- 配置系统参数和查看系统日志

**会议室权限**:
- 基础会议室：完全管理
- 高级会议室：完全管理
- VIP会议室：完全管理

**管理功能**:
- 用户管理：添加、编辑、删除用户，修改用户角色
- 会议室管理：添加、编辑、删除会议室和设备
- 权限管理：配置用户角色与会议室类型的权限映射
- 会议室类型管理：添加、编辑、删除会议室类型
- 系统设置：配置系统参数和查看系统日志

## 4. 权限检查机制

### 4.1 权限检查时机

1. **用户登录时**: 根据用户角色加载相应的权限配置
2. **会议室列表加载时**: 只显示用户有权限查看的会议室
3. **预订操作前**: 检查用户是否有权限预订该类型的会议室
4. **管理操作前**: 检查用户是否有管理权限
5. **界面元素显示时**: 根据权限动态显示或隐藏功能按钮

### 4.2 权限检查流程

```
用户操作 -> 获取用户角色 -> 查询权限映射表 -> 
检查对应权限 -> 允许/拒绝操作 -> 更新界面状态
```

### 4.3 权限缓存机制

为了提高性能，系统会缓存用户的权限配置：

1. **登录时缓存**: 用户登录成功后，将权限配置加载到内存
2. **权限变更时更新**: 当权限配置发生变更时，通知相关用户更新缓存
3. **定期刷新**: 定期刷新权限缓存，确保数据一致性

## 5. 权限管理功能

### 5.1 权限配置界面

系统管理员可以通过权限管理界面：

- 查看当前所有权限映射配置
- 添加新的权限映射
- 修改现有权限配置
- 删除不需要的权限映射
- 批量设置权限

### 5.2 权限配置规则

- 每个用户角色对每种会议室类型只能有一条权限记录
- 权限配置支持查看、预订、管理三种类型
- 权限变更立即生效，无需重启系统
- 支持权限配置的导入和导出

### 5.3 权限审计

系统提供权限审计功能：

- 记录权限配置的变更历史
- 记录用户权限检查的日志
- 提供权限使用统计报告
- 支持权限异常的告警

## 6. 扩展性设计

### 6.1 角色扩展

系统支持添加新的用户角色：

1. 在 `User.role` 枚举中添加新角色
2. 在 `PermissionMapping` 表中为新角色配置权限
3. 更新权限检查逻辑

### 6.2 会议室类型扩展

系统支持添加新的会议室类型：

1. 在 `RoomType` 表中添加新类型
2. 在 `PermissionMapping` 表中为新类型配置权限
3. 更新会议室管理界面

### 6.3 权限类型扩展

系统支持添加新的权限类型：

1. 在 `PermissionMapping` 表中添加新权限字段
2. 更新权限检查逻辑
3. 更新权限管理界面

## 7. 安全考虑

### 7.1 权限验证

- 所有关键操作都必须进行权限验证
- 权限检查在服务端进行，客户端验证仅用于用户体验
- 使用参数化查询防止SQL注入

### 7.2 数据保护

- 敏感权限数据加密存储
- 权限配置定期备份
- 权限变更操作记录详细日志

### 7.3 访问控制

- 基于最小权限原则设计权限
- 定期审查权限配置
- 支持权限的临时授权和回收

## 8. 总结

本权限设计文档定义了一个基于字段映射的权限管理系统，通过用户角色和会议室类型的组合来实现细粒度的权限控制。系统支持查看、预订、管理三种权限类型，具有良好的扩展性和安全性。权限配置灵活，支持动态调整，能够满足不同组织的权限管理需求。
