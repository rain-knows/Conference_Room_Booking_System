# 会议室预订系统设计文档 (V2.1 - 分栏式布局)

## 1. 系统概述

会议室预订系统旨在为企业或组织提供一个高效、便捷的会议室资源管理和预订平台。用户可以通过该系统实时查看会议室的可用状态、在线预订会议室、管理个人预订，并接收相关的通知提醒。管理员则可以对会议室信息、用户信息及系统参数进行维护。

## 2. 系统架构

系统采用经典的三层架构模式，结合事件驱动的图形用户界面。

| 层次/模块        | 技术选型/描述                                                                                                |
| ---------------- | ---------------------------------------------------------------------------------------------------------- |
| **表现层 (UI)**  | - **技术:** Java Swing
                     - **布局:** 主要采用分栏式布局（左侧导航，右侧内容展示），利用 `MigLayout` 库进行灵活布局。
                     - **职责:** 提供用户交互界面，展示数据，并将用户操作传递给业务逻辑层。                                                 |
| **业务逻辑层 (BLL)** | - **技术:** Java
                     - **职责:** 处理核心业务规则，如用户认证、会议室查询与预订逻辑、权限校验、数据校验等。协调表现层和数据访问层。                               |
| **数据访问层 (DAL)** | - **技术:** Java, JDBC (Java Database Connectivity)
                     - **职责:** 封装对数据库的直接操作（CRUD - Create, Read, Update, Delete），为业务逻辑层提供统一的数据访问接口。使用 `UserDAO.java` 等DAO模式类。 |
| **数据库 (DB)**    | - **技术:** MySQL
                     - **职责:** 持久化存储系统数据，包括用户信息、会议室详情、预订记录、角色权限等。                                           |

## 3. 功能模块详细设计

### 3.1 用户认证模块

| 功能点     | 描述                                                                                                                               |
| --------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 用户注册   | 新用户通过注册界面填写用户名、密码（需二次确认）、邮箱等信息完成注册。系统需校验用户名唯一性，密码复杂度（可选）。                                                               |
| 用户登录   | 已注册用户通过 <mcfile name="LoginForm.java" path="d:\code\java_code\Conference_Room_Booking_System\src\LoginForm.java"></mcfile> 输入用户名和密码进行登录。系统验证凭据，成功后进入 <mcfile name="MainPage.java" path="d:\code\java_code\Conference_Room_Booking_System\src\MainPage.java"></mcfile>。登录失败则提示错误信息。 |
| 退出登录   | 用户可以从主界面安全退出，清除会话信息，返回登录界面。                                                                                                 |

### 3.2 会议室查询与预订模块

| 功能点         | 描述                                                                                                                                                              |
| ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 会议室状态查看   | 用户可以在主界面右侧内容区查看所有会议室的实时状态。支持按日期、时间段、容纳人数、设备（如投影仪、白板）等条件进行筛选和排序。可用状态以不同颜色或标识清晰展示（例如，日历视图或列表视图）。                                                                 |
| 会议室详情查看   | 用户点击某个会议室后，可以查看其详细信息，包括名称、位置、容纳人数、可用设备列表、图片（可选）以及当前和未来的预订情况。                                                                                               |
| 预订会议室     | 用户选择合适的会议室和空闲时间段后，填写预订主题、参会人数等信息提交预订请求。系统需检查时间冲突，并确认用户权限。预订成功后，更新会议室状态并通知用户。                                                                                       |
| 我的预订管理   | 用户可以在“我的预订”界面查看自己所有已成功预订的会议列表（按时间排序）。                                                                                                                               |
| 修改预订 (可选) | 在特定条件下（如预订开始前一段时间），用户可以修改自己的预订信息（如时间、主题），需重新检查冲突。                                                                                                             |
| 取消预订       | 用户可以在预订开始前的一定时间内取消自己的预订。取消后，会议室在该时间段的状态将更新为可用。                                                                                                                   |

### 3.3 个人中心模块

| 功能点     | 描述                                                               |
| --------- | ------------------------------------------------------------------ |
| 查看个人信息 | 用户可以查看自己的注册信息，如用户名、邮箱等。                                           |
| 修改个人信息 | 用户可以修改部分个人信息，如联系方式（邮箱）。                                           |
| 修改密码   | 用户可以修改自己的登录密码，需要输入旧密码和新密码（需二次确认）。                                   |

### 3.4 管理员功能模块 (需权限控制)

#### 3.4.1 会议室管理

| 功能点       | 描述                                                                                             |
| ----------- | ------------------------------------------------------------------------------------------------ |
| 添加会议室   | 管理员可以添加新的会议室，包括输入会议室名称、位置、容纳人数、可用设备（可多选）、描述等信息。                                                               |
| 修改会议室信息 | 管理员可以编辑已存在的会议室的详细信息。                                                                         |
| 删除会议室   | 管理员可以删除不再使用或需要下线的会议室。若会议室有未完成的预订，需给出提示或处理方案。                                                                   |
| 查看所有会议室 | 管理员可以列表形式查看系统中所有会议室及其当前状态和基本信息。                                                                   |

#### 3.4.2 用户管理

| 功能点     | 描述                                                                                               |
| --------- | -------------------------------------------------------------------------------------------------- |
| 查看用户列表 | 管理员可以查看系统中所有已注册用户的列表，包括用户名、注册时间、用户角色等。                                                                 |
| 修改用户信息 | 管理员可以修改用户的基本信息（如重置密码，修改用户角色）。                                                                       |
| 禁用/启用用户 | 管理员可以禁用某些用户账户，使其无法登录系统；也可以重新启用被禁用的账户。                                                                     |
| 删除用户   | 管理员可以删除用户账户（需谨慎操作，考虑关联数据处理）。                                                                           |

#### 3.4.3 系统设置与维护

| 功能点     | 描述                                                                                             |
| --------- | ------------------------------------------------------------------------------------------------ |
| 预订规则设置 | (可选) 管理员可以设置预订规则，如最长预订时长、提前预订天数、取消预订时限等。                                                                 |
| 查看操作日志 | (可选) 系统记录关键操作日志（如登录、预订、管理操作），管理员可查看日志用于审计或问题排查。                                                               |
| 数据备份与恢复 | (规划中) 提供数据备份和恢复的功能入口或说明。                                                                      |

## 4. 界面设计 (分栏式布局 - <mcfile name="MainPage.java" path="d:\code\java_code\Conference_Room_Booking_System\src\MainPage.java"></mcfile>)

*   **整体布局:** 使用 `MigLayout` 实现，窗口分为左右两栏。
    *   **左侧导航栏 (Sidebar Panel):** 固定宽度 (例如 `200px`)，背景色稍深以区分。包含一个导航标题和一组功能按钮。
        *   `lblNavigationTitle`: 显示“导航菜单”。
        *   `btnRoomStatus`: “会议室状态”
        *   `btnMyBookings`: “我的预订”
        *   `btnProfile`: “个人信息”
        *   `btnAdminRoomMgmt`: “会议室管理” (管理员可见)
        *   `btnAdminUserMgmt`: “用户管理” (管理员可见)
        *   `btnAdminSettings`: “系统设置” (管理员可见)
        *   `btnLogout`: “退出登录”，通常置于导航栏底部。
    *   **右侧内容区 (Content Panel):** 占据剩余宽度，背景色通常为白色。根据左侧导航栏的选择，动态加载和显示对应的功能界面 (JPanel)。初始状态可显示欢迎信息或默认功能界面（如会议室状态）。

*   **交互逻辑:**
    *   点击左侧导航按钮时，右侧 `contentPanel` 的内容会通过 `showContent(String contentName)` 方法进行更新。
    *   `showContent` 方法会先移除 `contentPanel` 中的旧组件，然后根据传入的 `contentName` 创建新的 `JPanel` (例如 `RoomStatusPanel`, `MyBookingsPanel` 等，这些 Panel 需要单独创建) 并添加到 `contentPanel` 中，最后调用 `revalidate()` 和 `repaint()` 刷新界面。

*   **技术点说明:**
    *   **Java Swing:** 用于构建图形用户界面的标准Java库。提供了丰富的组件如 `JFrame`, `JPanel`, `JButton`, `JLabel` 等。
    *   **MigLayout:** 一个第三方布局管理器，比 Swing 内置的布局管理器更强大和灵活。通过约束字符串（如 `"wrap 1, fillx"`）来控制组件的排列和大小，能轻松实现复杂布局。
        *   `"insets 0, fill"`: 应用于 `JFrame` 的 `MigLayout`，表示无边距，且布局填充整个窗口。
        *   `"[200px!,fill][grow,fill]"`: 定义两列，第一列固定宽度200px并填充，第二列占据剩余空间并填充。
        *   `"[grow,fill]"`: 定义行高占据可用空间并填充。
        *   `"wrap 1, fillx, insets 5"`: 应用于侧边栏 `JPanel`，每行一个组件，水平填充，内边距为5。
        *   `"growx"`: 应用于按钮，使其水平填充所在单元格。
        *   `"gaptop push"`: 将组件及其下方组件推至容器底部。
        *   `"dock west"`: 将侧边栏停靠在窗口西部。
    *   **`SwingUtilities.invokeLater()`:** 确保所有Swing界面的创建和更新都在事件分发线程 (EDT) 中执行，这是Swing编程的最佳实践，避免多线程问题。

## 5. 数据库设计

详细设计参考项目中的 <mcfolder name="docs" path="d:\code\java_code\Conference_Room_Booking_System\docs"></mcfolder> 目录下的 `database_design.md` 和 `complete_database_creation.sql`。

**核心表结构概要:**

*   **`users`**
    *   `user_id` (INT, PK, AI)
    *   `username` (VARCHAR, UNIQUE, NOT NULL)
    *   `password_hash` (VARCHAR, NOT NULL) - 存储加密后的密码
    *   `email` (VARCHAR, UNIQUE, NOT NULL)
    *   `role_id` (INT, FK references `roles.role_id`)
    *   `created_at` (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
*   **`roles`**
    *   `role_id` (INT, PK, AI)
    *   `role_name` (VARCHAR, UNIQUE, NOT NULL) - 例如 'administrator', 'user'
*   **`conference_rooms`**
    *   `room_id` (INT, PK, AI)
    *   `room_name` (VARCHAR, NOT NULL)
    *   `capacity` (INT)
    *   `location` (VARCHAR)
    *   `description` (TEXT)
    *   `is_active` (BOOLEAN DEFAULT TRUE)
*   **`room_equipment`** (会议室设备关联表 - 多对多)
    *   `room_id` (INT, FK references `conference_rooms.room_id`)
    *   `equipment_id` (INT, FK references `equipment.equipment_id`)
    *   PRIMARY KEY (`room_id`, `equipment_id`)
*   **`equipment`** (设备表)
    *   `equipment_id` (INT, PK, AI)
    *   `equipment_name` (VARCHAR, UNIQUE, NOT NULL) - 例如 'Projector', 'Whiteboard', 'Video Conferencing'
*   **`bookings`**
    *   `booking_id` (INT, PK, AI)
    *   `room_id` (INT, FK references `conference_rooms.room_id`)
    *   `user_id` (INT, FK references `users.user_id`)
    *   `start_time` (DATETIME, NOT NULL)
    *   `end_time` (DATETIME, NOT NULL)
    *   `purpose` (VARCHAR)
    *   `status` (ENUM('confirmed', 'pending', 'cancelled') DEFAULT 'confirmed')
    *   `created_at` (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)

## 6. 非功能性需求

| 需求类型   | 描述                                                                                                                               |
| -------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| **易用性** | 界面设计直观、简洁，用户操作流程清晰明了。提供必要的提示信息和错误反馈。                                                                                     |
| **可靠性** | 系统应能长时间稳定运行，预订数据准确无误，避免数据丢失或不一致。对于并发预订请求，应有机制处理冲突（例如，通过数据库事务或乐观锁/悲观锁）。                                                               |
| **安全性** | - 用户密码必须加密存储（例如使用 bcrypt 或 Argon2）。
             - 防止常见的Web安全漏洞（虽然是桌面应用，但数据交互安全仍需考虑，如SQL注入，尽管JDBC预编译语句可部分防范）。
             - 实现基于角色的访问控制 (RBAC)，确保用户只能访问其权限范围内的功能和数据。                                                                 |
| **可维护性** | - 代码结构清晰，遵循良好的编程规范和设计模式（如DAO模式）。
             - 模块化设计，降低模块间的耦合度。
             - 提供必要的注释和文档。                                                                                                             |
| **性能**   | - 系统对用户操作的响应时间应在可接受范围内（例如，查询会议室状态、提交预订请求等操作应在几秒内完成）。
             - 数据库查询应进行优化，对常用查询字段建立索引。                                                                                               |
| **可扩展性** | 系统设计应考虑到未来功能扩展的可能性，例如集成日历服务、增加审批流程等。                                                                                       |

## 7. 待办与未来展望

*   实现各导航按钮对应的具体功能面板 (JPanel)。
*   完善用户角色与权限管理逻辑。
*   增加会议室预订冲突的实时检测与提示。
*   实现管理员对预订的审批功能 (如果需要)。
*   添加邮件/系统内通知功能，用于预订成功、预订提醒、预订变更等。
*   考虑引入日志框架 (如 Log4j 或 SLF4j) 进行更完善的日志记录。
*   单元测试和集成测试的覆盖。